/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as A,jsx as e,Fragment as me}from"@dropins/tools/preact-jsx-runtime.js";import{useState as T,useEffect as G,useRef as ce,useCallback as B}from"@dropins/tools/preact-hooks.js";import{Slot as Ie,classes as Se}from"@dropins/tools/lib.js";import{Card as Q,InLineAlert as se,ProgressSpinner as ue,Field as pe,Input as ye,Button as P,Modal as fe,Header as Te}from"@dropins/tools/components.js";import{f as Ce}from"../chunks/fetchUserPermissions.js";import{b as he}from"../chunks/company-permissions.js";import{useText as W}from"@dropins/tools/i18n.js";import{u as we}from"../chunks/useCompanyContextListener.js";import{a as Ee,i as Ne}from"../chunks/isCompanyUser.js";import*as ge from"@dropins/tools/preact-compat.js";import{memo as ve}from"@dropins/tools/preact-compat.js";import{T as Ue}from"../chunks/Tree.js";import{C as Me}from"../chunks/CompanyUserForm.js";import{a as xe,b as _e}from"../chunks/CompanyLoaders.js";import{events as ne}from"@dropins/tools/event-bus.js";import{p as ie,E as le}from"../chunks/acdl.js";import{g as ke,c as De,u as Ae,a as Pe,b as Le,d as Fe}from"../chunks/updateCompanyTeam.js";import{d as Re}from"../chunks/updateCompanyUser.js";import{u as Ve}from"../chunks/useInLineAlert.js";import"../chunks/fetch-error.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/isCompanyRoleNameAvailable.js";const ze=u=>ge.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},ge.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"}));function Be(u){const{mode:U,entityId:p,parentStructureId:d,onSaved:t,onError:h,onSuccess:i}=u,n=W({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError",createTeamSuccess:"Company.CompanyStructure.messages.createTeamSuccess",updateTeamSuccess:"Company.CompanyStructure.messages.updateTeamSuccess"}),[m,o]=T({id:"",name:"",description:""}),[g,S]=T({}),[f,D]=T({}),[E,M]=T(!1),[R,L]=T(null);G(()=>{U!=="edit"||!p||(M(!0),ke(p).then(C=>{C&&o({id:C.id,name:C.name||"",description:C.description||""})}).finally(()=>M(!1)))},[U,p]);const O=(C,w)=>C==="name"?w.trim()?null:n.teamTitleRequired:null,_=(C,w)=>{o(x=>({...x,[C]:w})),R&&L(null)};return{values:m,errors:g,touched:f,loading:E,setValue:_,onBlur:(C,w)=>{w!==void 0&&_(C,w),D(F=>({...F,[C]:!0}));const x=w!==void 0?w:m[C]||"",b=O(C,x);S(b?F=>({...F,[C]:b}):F=>{const V={...F};return delete V[C],V})},submit:async()=>{const C=O("name",m.name);if(C){S({name:C}),D({name:!0});return}const w=m.name;try{if(U==="add"){const x=await De({name:m.name,description:m.description||null,targetId:d??null});if(!x){const b=n.createTeamError;h?h(b):L(b);return}t({label:w,structureId:x.structureId,entityId:x.id,type:"team",description:m.description||void 0}),i&&i(n.createTeamSuccess)}else p&&(await Ae({id:p,name:m.name,description:m.description||null}),t({label:w,entityId:p,type:"team",description:m.description||void 0}),i&&i(n.updateTeamSuccess))}catch(x){const b=x instanceof Error?x.message:n.saveTeamError;h?h(b):L(b)}},generalError:R}}const Oe=ve(({mode:u,entityId:U,parentStructureId:p,permissions:d,onSaved:t,onCancel:h,onError:i,onSuccess:n})=>{const m=(d==null?void 0:d.canEditUsers)??!1,{values:o,errors:g,touched:S,loading:f,onBlur:D,submit:E,generalError:M}=Be({mode:u,entityId:U,parentStructureId:p,onSaved:t,onError:i?_=>{i(_),h()}:void 0,onSuccess:n}),[R,L]=T(!1),O=W({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return A("div",{children:[e("h3",{className:"acm-structure-panel__title",children:u==="add"?O.addTeam:O.editTeam}),A(Q,{variant:"secondary",className:`company-team-form__card ${R?"is-working":""}`,children:[!i&&M?e(se,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:M}):null,R?e("div",{className:"company-team-form__overlay","aria-live":"polite",children:e(ue,{size:"small"})}):null,f?e(xe,{}):A("div",{className:"company-team-form__content",children:[e(pe,{label:O.teamTitle,required:!0,className:"acm-structure-panel__field",error:S.name&&g.name?g.name:void 0,children:e(ye,{name:"team_title",type:"text",value:o.name,onBlur:_=>{const Y=_.target;D("name",Y.value)},variant:"primary",size:"medium",disabled:!m})}),e(pe,{label:O.description,className:"acm-structure-panel__field",children:e(ye,{name:"team_description",type:"textarea",value:o.description||"",onBlur:_=>{const Y=_.target;D("description",Y.value)},variant:"primary",size:"medium",disabled:!m})})]})]}),f?null:A("div",{className:"acm-structure-modal__actions",children:[e(P,{type:"button",variant:"primary",onClick:async()=>{if(!R){L(!0);try{await E()}finally{L(!1)}}},disabled:R||!m,children:"Save"}),e(P,{type:"button",variant:"secondary",disabled:R,onClick:h,children:"Cancel"})]})]})});function He({handleSetInLineAlert:u,permissions:U}={permissions:null}){const p=(U==null?void 0:U.canViewUsers)??!1,d=W({loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem",removeUserSuccess:"Company.CompanyStructure.messages.removeUserSuccess",deleteTeamSuccess:"Company.CompanyStructure.messages.deleteTeamSuccess",removeMultipleSuccess:"Company.CompanyStructure.messages.removeMultipleSuccess",moveUserSuccess:"Company.CompanyStructure.messages.moveUserSuccess",moveTeamSuccess:"Company.CompanyStructure.messages.moveTeamSuccess"}),{loadError:t,updateError:h}=d,[i,n]=T(null),[m,o]=T(!0),[g,S]=T(!1),[f,D]=T(!1),[E,M]=T(new Set),[R,L]=T(null),[O,_]=T(new Set),[Y,J]=T({}),C=ce(u),w=ce(!1),x=ce(!1);G(()=>{C.current=u},[u]);const b=B((r,l)=>{u&&(r==="success"?u({type:"success",text:l}):r==="error"?u({type:"error",text:l}):u(),S(!1))},[u]),F=B(async()=>{if(w.current)return null;if(w.current=!0,!p)return o(!1),n(null),M(new Set),L(null),_(new Set),w.current=!1,null;o(!0);try{const l=await Pe();return n(l),M(new Set(l.map(k=>k.id))),o(!1),l}catch{return o(!1),C.current&&C.current({type:"error",text:t}),null}finally{w.current=!1}},[p,t]);G(()=>{p&&!x.current&&(x.current=!0,F())},[p,F]),G(()=>{const r=()=>{o(!0),M(new Set),L(null),_(new Set),F()},l=ne.on("companyContext/changed",r,{eager:!0});return()=>{l==null||l.off()}},[F]);const V=B(async(r,l)=>{try{if(S(!0),!await Le({id:r,parentId:l}))return b("error",d.failedToMoveItem),!1;const I=new Map(i==null?void 0:i.map(a=>[a.id,a])).get(r),z=(I==null?void 0:I.type)==="team"?d.moveTeamSuccess:d.moveUserSuccess;return n(a=>a?a.map(c=>c.id===r?{...c,parentId:l}:c):null),M(a=>new Set([...a,l])),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:r,newParentId:l}),ne.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:r,newParentId:l,nodes:i||[]}),b("success",z),!0}catch(k){const H=k instanceof Error?k.message:h;return b("error",H),!1}finally{S(!1)}},[i,b,h,d.failedToMoveItem,d.moveUserSuccess,d.moveTeamSuccess]),oe=B(()=>{i&&M(new Set(i.map(r=>r.id)))},[i]),q=B(()=>{if(i){const r=i.filter(l=>l.parentId===null).map(l=>l.id);M(new Set(r))}},[i]),Z=B(r=>{n(l=>{const k=l?[...l,{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}]:[{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}];return ne.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodes:k}),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodeType:r.type}),k}),r.parentId&&M(l=>new Set([...l,r.parentId]))},[]),X=B((r,l,k)=>{l&&n(H=>H?H.map(I=>r.includes(I.id)?{...I,label:l,description:k}:I):null)},[]),ee=B(async r=>{if(r.length)try{S(!0);const l=new Map((i||[]).map(I=>[I.id,I])),k=r.map(I=>l.get(I)).filter(Boolean);for(const I of r){const z=l.get(I);!z||!z.entityId||(z.type==="team"?await Fe(z.entityId):await Re({id:z.entityId}))}n(I=>{if(!I)return null;const z=new Set(r);return I.filter(a=>!z.has(a.id))}),L(null),_(new Set),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:r}),ne.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:r,nodes:i||[]});let H;if(r.length===1){const I=k[0];H=(I==null?void 0:I.type)==="team"?d.deleteTeamSuccess:d.removeUserSuccess}else H=d.removeMultipleSuccess.replace("{count}",r.length.toString());b("success",H)}catch(l){const k=l instanceof Error?l.message:h;b("error",k)}finally{S(!1)}},[i,b,h,d.removeUserSuccess,d.deleteTeamSuccess,d.removeMultipleSuccess]),te=B(r=>{J(r)},[]),K=B(()=>{D(!0),b("success",""),J({})},[b]),ae=B(r=>{r==null||r(),D(!1),J({})},[]);return{nodes:i,loading:m,submitLoading:g,showEditForm:f,inputChange:Y,expanded:E,setExpanded:M,selected:R,setSelected:L,selectedMany:O,setSelectedMany:_,move:V,expandAll:oe,collapseAll:q,insertNode:Z,renameNodes:X,removeNodes:ee,handleInputChange:te,handleShowEditForm:K,handleHideEditForm:ae,renderAlertMessage:b,working:g}}const $e=ve(({permissions:u,slots:U})=>{var z;const p=(u==null?void 0:u.canEditUsers)??!1,d=(u==null?void 0:u.canViewUsers)??!1,t=W({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:h,handleSetInLineAlert:i}=Ve(),{nodes:n,loading:m,submitLoading:o,expanded:g,setExpanded:S,selected:f,setSelected:D,selectedMany:E,setSelectedMany:M,move:R,expandAll:L,collapseAll:O,insertNode:_,renameNodes:Y,removeNodes:J}=He({handleSetInLineAlert:i,permissions:u}),[C,w]=T(null),[x,b]=T("add"),[F,V]=T(!1),[oe,q]=T([]),[Z,X]=T({title:"",body:"",confirmLabel:t.remove,blocked:!1}),[ee,te]=T(null),K=()=>w(null),ae=((z=n==null?void 0:n.find(a=>a.parentId===null))==null?void 0:z.id)??null,r=(n||[]).map(a=>({id:a.id,parentId:a.parentId,label:a.label})),l=a=>{if(!n)return 0;let c=0;const y=[a],s=new Set;for(;y.length>0;){const N=y.pop();if(!N||s.has(N))continue;s.add(N);const v=n.filter($=>$.parentId===N);c+=v.length,v.forEach($=>y.push($.id))}return c},k=(a,c)=>{let y=a;const s=new Map(r.map(v=>[v.id,v])),N=new Set;for(;y&&!N.has(y);){N.add(y);const v=s.get(y);if(!v)break;if(v.parentId===c)return!0;y=v.parentId??null}return!1},H=(n||[]).map(a=>({id:a.id,parentId:a.parentId,label:a.label,type:a.type,description:a.description,entityId:a.entityId})),I=A(me,{children:[(()=>{const a=E!=null&&E.size?Array.from(E):f?[f]:[],c=p&&a.length===1,y=p&&a.length>=1;return e(Q,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:A("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":t.companyStructureActions,children:[e(P,{type:"button",variant:"secondary",onClick:L,"aria-label":t.expandAllNodes,disabled:!d,"aria-disabled":!d,children:t.expandAll}),e(P,{type:"button",variant:"secondary",onClick:O,"aria-label":t.collapseAllNodes,disabled:!d,"aria-disabled":!d,children:t.collapseAll}),e(P,{type:"button",variant:"primary",onClick:()=>{b("add"),w("user")},"aria-label":t.addUserAria,disabled:!p,"aria-disabled":!p,children:t.addUser}),e(P,{type:"button",variant:"primary",onClick:()=>{b("add"),w("team")},"aria-label":t.addTeamAria,disabled:!p,"aria-disabled":!p,children:t.addTeam}),e(P,{type:"button",variant:"primary",disabled:!c,"aria-disabled":!c,"aria-label":t.editSelectedAria,onClick:()=>{if(!c)return;const s=a,N=n==null?void 0:n.find(v=>v.id===s[0]);(N==null?void 0:N.type)==="user"?(b("edit"),w("user")):(b("edit"),w("team"))},children:t.editSelected}),e(P,{type:"button",variant:"secondary",disabled:!y||o,"aria-disabled":!y||o,"aria-label":t.removeSelectedAria,onClick:()=>{if(!y||o)return;const s=a;if(s.length===1){const N=n==null?void 0:n.find($=>$.id===s[0]);if(!N)return;(n==null?void 0:n.some($=>$.parentId===N.id))?(X({title:N.type==="user"?t.cannotDeleteUser:t.cannotDeleteTeam,body:N.type==="user"?t.cannotDeleteUserMessage:t.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),q([]),V(!0)):(X({title:N.type==="user"?t.removeUserConfirm:t.deleteTeamConfirm,body:N.type==="user"?t.removeUserMessage:t.deleteTeamMessage,confirmLabel:N.type==="user"?t.remove:t.delete,blocked:!1}),q(s),V(!0))}else X({title:t.removeItemsConfirm.replace("{count}",s.length.toString()),body:t.removeItemsMessage,confirmLabel:t.remove,blocked:!1}),q(s),V(!0)},children:t.remove})]})})})(),C?A("div",{className:"acm-structure-panel",children:[o?A("div",{className:"acm-structure-working","aria-live":"polite",children:[e(ue,{size:"small"})," ",t.processing]}):null,C==="user"?(()=>{const a=E!=null&&E.size?Array.from(E):f?[f]:[],c=a.length?n==null?void 0:n.find(s=>s.id===a[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(Me,{mode:x,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:u,onSaved:s=>{x==="add"?s.structureId&&(_({id:s.structureId,parentId:y,label:s.label,type:s.type,entityId:s.entityId}),s.structureId&&(D(s.structureId),M(new Set([s.structureId])))):a.length&&Y(a,s.label),K()},onCancel:K,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null,C==="team"?(()=>{const a=E!=null&&E.size?Array.from(E):f?[f]:[],c=a.length?n==null?void 0:n.find(s=>s.id===a[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(Oe,{mode:x,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:u,onSaved:s=>{x==="add"?s.structureId&&(_({id:s.structureId,parentId:y,label:s.label,type:s.type,entityId:s.entityId,description:s.description}),s.structureId&&(D(s.structureId),M(new Set([s.structureId])))):a.length&&Y(a,s.label,s.description),K()},onCancel:K,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null]}):null,h&&h.text?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(se,{className:"acm-structure-panel__notification",type:h.type||"success",variant:"secondary",heading:h.text})}):null,!m&&!o&&n&&n.length===0?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(se,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:t.noStructureData})}):null,!m&&o?e("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:e(ue,{size:"medium"})}):null,m?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e("div",{className:"acm-structure-tree-content",children:e(_e,{rows:8})})}):null,!m&&n&&n.length>0?e("div",{className:`acm-structure-tree-card ${o?"is-working":""}`,children:e(Ue,{rootId:null,items:r,expandedIds:g,selectedId:f,selectedIds:E,onExpandedChange:S,onSelectedChange:D,onSelectedIdsChange:M,renderExpander:({expanded:a,toggle:c})=>e("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${a?"is-open":""}`,"aria-label":a?t.collapse:t.expand,onClick:y=>{y.stopPropagation(),c()},children:e("span",{className:`acm-structure-chevron ${a?"is-expanded":""}`})}),renderNode:({item:a,hasChildren:c,expander:y,icon:s,select:N})=>{const v=n==null?void 0:n.find(j=>j.id===a.id),$=l(a.id),re=(v==null?void 0:v.description)||"",be=(v==null?void 0:v.type)==="team"&&re,de=(v==null?void 0:v.parentId)===null;return A("div",{className:"acm-structure-row",onClick:N,children:[!de&&e("span",{className:"acm-structure-handle","aria-hidden":!0}),s?e("span",{onClick:j=>j.stopPropagation(),children:s()}):e("span",{className:`acm-structure-icon ${(v==null?void 0:v.type)==="team"?"is-team":"is-user"} ${de?"is-root":""}`,"aria-hidden":!0}),A("div",{className:"acm-structure-info",children:[e("span",{className:"acm-structure-label",children:a.label}),re?e("span",{className:"acm-structure-description",children:re}):null]}),be?e(P,{type:"button",variant:"secondary",onClick:j=>{j.stopPropagation(),te({id:a.id,text:re})},"aria-label":t.showDescription,className:"acm-structure-description-button",children:"?"}):null,$>0?e("span",{className:"acm-structure-count",children:$}):null,c&&y?e("span",{className:"acm-structure-expander-wrapper",onClick:j=>j.stopPropagation(),children:y()}):null]})},draggable:a=>{const c=n==null?void 0:n.find(s=>s.id===a.id),y=c?c.parentId===null:!1;return!o&&p&&!y},canDrop:(a,c)=>{if(!p||a===c)return!1;const y=n==null?void 0:n.find(s=>s.id===a);return y&&y.parentId===c?!1:!k(c,a)},onMove:async({id:a,newParentId:c})=>{p&&await R(a,c)}})}):null,F?e(fe,{open:F,onClose:()=>{o||(V(!1),q([]))},children:A("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:Z.title}),e("div",{children:Z.body}),e("div",{className:"acm-structure-modal-actions",children:Z.blocked?e(P,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(V(!1),q([]))},children:t.ok}):A(me,{children:[e(P,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(V(!1),q([]))},children:t.cancel}),e(P,{type:"button",variant:"primary",disabled:o,onClick:async()=>{await J(oe),V(!1),q([])},children:o?Z.confirmLabel===t.delete?t.deleting:t.removing:Z.confirmLabel||t.remove})]})})]})}):null,ee?e(fe,{open:!!ee,onClose:()=>te(null),children:A("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:t.teamDescription}),e("div",{children:ee.text}),e("div",{className:"acm-structure-modal-actions",children:e(P,{type:"button",variant:"secondary",onClick:()=>te(null),children:t.close})})]})}):null]});return U!=null&&U.StructureData?e(Ie,{name:"StructureData",slot:U.StructureData,context:{structureData:H,Default:I}}):I}),Ye=()=>{const u=W({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[U,p]=T(null),[d,t]=T(!0),[h,i]=T(null),n=B(async()=>{var m,o;try{t(!0),i(null);const{roleResponse:g}=await Ce(),S=(o=(m=g==null?void 0:g.data)==null?void 0:m.customer)==null?void 0:o.role,f=he(S);p(f)}catch(g){i(g instanceof Error?g:new Error(u.fetchPermissionsError))}finally{t(!1)}},[u.fetchPermissionsError]);return G(()=>{let m=!0;return(async()=>{var g,S;try{t(!0),i(null);const{roleResponse:f}=await Ce();if(!m)return;const D=(S=(g=f==null?void 0:f.data)==null?void 0:g.customer)==null?void 0:S.role,E=he(D);p(E)}catch(f){if(!m)return;i(f instanceof Error?f:new Error(u.fetchPermissionsError))}finally{m&&t(!1)}})(),()=>{m=!1}},[]),{permissions:U,loading:d,error:h,refreshPermissions:n}},qe="/customer/company/create",Ze=({className:u,children:U,createCompanyAccountUrl:p=qe,...d})=>{const t=W({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),h=t.individualUserMessage||"You don't have a company account yet.";return e(Q,{variant:"secondary",className:Se(["company-management-company-structure-card",u]),...d,children:A("div",{children:[e(se,{type:"warning",variant:"secondary",heading:h,icon:e(ze,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),e("div",{className:"company-management-company-structure-card__cta",children:e(P,{as:"a",href:p,variant:"primary","data-testid":"company-structure-create-company-button",children:t.createAccountCta||"Create a Company Account"})})]})})},Ct=({className:u,withHeader:U=!1,slots:p,isAuthenticated:d=!1,onRedirectLogin:t,onRedirectAccount:h})=>{const i=W({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:n,refreshPermissions:m}=Ye(),[o,g]=T("loading");return we(m),G(()=>{let S=!0;return(async()=>{try{if(!d){S&&g("redirect-login");return}if(!await Ee()){S&&(console.log("Company registration disabled - redirecting to account dashboard"),g("redirect-account"));return}await Ne()?S&&g("show-structure"):S&&g("show-empty")}catch(f){console.error("Error in CompanyStructure - redirecting to login page:",f),S&&g("redirect-login")}})(),()=>{S=!1}},[d]),G(()=>{o==="redirect-login"&&t&&t(),o==="redirect-account"&&h&&h()},[o,t,h]),o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="show-empty"?e(Ze,{className:u}):o==="show-structure"?A("div",{className:Se(["account-company-structure",u]),children:[U?e(Te,{title:i.containerTitle,divider:!1,className:"company-structure__title"}):null,e($e,{slots:p,permissions:n})]}):null};export{Ct as CompanyStructure,Ct as default};
//# sourceMappingURL=CompanyStructure.js.map
